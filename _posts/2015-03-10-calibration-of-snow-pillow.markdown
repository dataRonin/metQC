---
layout: post
title: "Calibration of Snow Pillow"
date: 2015-03-10T13:12:47-07:00
---

The old data from Varamet's snow course (SNOVAN04) and snow pillow (SNOVAN05) were compared. John did a great work of weighing out the snow-pillow but ultimately manual tests could not look like the actual system. The maximum SWE simulated by the test was less than 40 mm. The actual SWE which can occur on this site can be near 1000 mm. 

1. We removed the 1.92 correction factor
2. We found the matching dates/hours and the Snow Water Equivalancies (SWE's) associated with those times.
3. We performed linear regression


The output was then "forced" through 0, to get a ratio of SWE from the course to SWE from the pillow of 1.95. Without the forcing it was 1.94, which accounts for an offset of 2 mm. The R-squared for this fit was 0.98. We also tried an exponential fit, but it did not improve very much (to R-squared 0.983)

We will modify the old data to fit the 1.95 calibration factor, which can be justfied based on this analysis. Here is a graph:


<style>

</style>

<div id="fig_el7892043709277604105873069"></div>
<script>
function mpld3_load_lib(url, callback){
  var s = document.createElement('script');
  s.src = url;
  s.async = true;
  s.onreadystatechange = s.onload = callback;
  s.onerror = function(){console.warn("failed to load library " + url);};
  document.getElementsByTagName("head")[0].appendChild(s);
}

if(typeof(mpld3) !== "undefined" && mpld3._mpld3IsLoaded){
   // already loaded: just create the figure
   !function(mpld3){
       
       mpld3.draw_figure("fig_el7892043709277604105873069", {"axes": [{"xlim": [0.0, 600.0], "yscale": "linear", "axesbg": "#FFFFFF", "texts": [{"v_baseline": "hanging", "h_anchor": "middle", "color": "#000000", "text": "SWE_pillow", "coordinates": "axes", "zorder": 3, "alpha": 1, "fontsize": 12.0, "position": [0.5, -0.059895833333333329], "rotation": -0.0, "id": "el789204371027408"}, {"v_baseline": "auto", "h_anchor": "middle", "color": "#000000", "text": "SWE_course", "coordinates": "axes", "zorder": 3, "alpha": 1, "fontsize": 12.0, "position": [-0.084047379032258063, 0.5], "rotation": -90.0, "id": "el789204371162448"}], "zoomable": true, "images": [], "xdomain": [0.0, 600.0], "ylim": [0.0, 1200.0], "paths": [], "sharey": [], "sharex": [], "axesbgalpha": null, "axes": [{"scale": "linear", "tickformat": null, "grid": {"gridOn": false}, "fontsize": 12.0, "position": "bottom", "nticks": 7, "tickvalues": null}, {"scale": "linear", "tickformat": null, "grid": {"gridOn": false}, "fontsize": 12.0, "position": "left", "nticks": 7, "tickvalues": null}], "lines": [{"color": "#000000", "yindex": 2, "coordinates": "data", "dasharray": "6,6", "zorder": 2, "alpha": 1, "xindex": 0, "linewidth": 1.0, "data": "data01", "id": "el789204435494160"}], "markers": [{"edgecolor": "#000000", "facecolor": "#FF0000", "edgewidth": 0.5, "yindex": 1, "coordinates": "data", "zorder": 2, "markerpath": [[[0.0, 3.0], [0.7956093000000001, 3.0], [1.5587396123545605, 2.683901074764725], [2.121320343559643, 2.121320343559643], [2.683901074764725, 1.5587396123545605], [3.0, 0.7956093000000001], [3.0, 0.0], [3.0, -0.7956093000000001], [2.683901074764725, -1.5587396123545605], [2.121320343559643, -2.121320343559643], [1.5587396123545605, -2.683901074764725], [0.7956093000000001, -3.0], [0.0, -3.0], [-0.7956093000000001, -3.0], [-1.5587396123545605, -2.683901074764725], [-2.121320343559643, -2.121320343559643], [-2.683901074764725, -1.5587396123545605], [-3.0, -0.7956093000000001], [-3.0, 0.0], [-3.0, 0.7956093000000001], [-2.683901074764725, 1.5587396123545605], [-2.121320343559643, 2.121320343559643], [-1.5587396123545605, 2.683901074764725], [-0.7956093000000001, 3.0], [0.0, 3.0]], ["M", "C", "C", "C", "C", "C", "C", "C", "C", "Z"]], "alpha": 1, "xindex": 0, "data": "data01", "id": "el789204435493456pts"}], "id": "el789204370929424", "ydomain": [0.0, 1200.0], "collections": [], "xscale": "linear", "bbox": [0.125, 0.099999999999999978, 0.77500000000000002, 0.80000000000000004]}], "height": 480.0, "width": 640.0, "plugins": [{"type": "reset"}, {"enabled": false, "button": true, "type": "zoom"}, {"enabled": false, "button": true, "type": "boxzoom"}], "data": {"data01": [[0.52, 0.0, 1.0143688373839572], [0.0, 0.0, 0.0], [471.88, 1031.0, 920.5007057398878], [0.0, 0.0, 0.0], [60.42, 193.0, 117.86185606680517], [102.6, 178.0, 200.14277445306536], [0.0, 0.0, 0.0], [0.52, 0.0, 1.0143688373839572], [192.71, 361.0, 375.92118971588917], [156.77, 279.0, 305.81269737823646], [0.0, 0.0, 0.0], [14.06, 51.0, 27.42697279542007], [0.0, 0.0, 0.0], [0.52, 0.0, 1.0143688373839572], [8.33, 25.0, 16.249408491169927], [441.15, 884.0, 860.5554088691013], [350.0, 615.0, 682.7482559315096], [218.23, 438.0, 425.7032911198095], [416.15, 711.0, 811.7876763025648], [3.13, 0.0, 6.105720117330357], [0.0, 25.0, 0.0], [73.96, 147.0, 144.27446002484126], [0.0, 0.0, 0.0], [13.54, 25.0, 26.41260395803611], [70.31, 127.0, 137.15437107012698], [319.79, 559.0, 623.817327898107], [86.98, 173.0, 169.67269514549344], [0.52, 0.0, 1.0143688373839572], [547.92, 1102.0, 1068.8326411142648], [472.4, 965.0, 921.5150745772718], [182.81, 432.0, 356.60916761954076], [55.21, 117.0, 107.69866059993899], [282.29, 544.0, 550.6657290483024], [58.85, 142.0, 114.79924246162669], [73.96, 140.0, 144.27446002484126], [0.0, 0.0, 0.0], [81.25, 178.0, 158.49513084124328], [53.13, 132.0, 103.64118525040315], [127.6, 254.0, 248.91050701960177], [0.0, 0.0, 0.0], [233.85, 330.0, 456.1733704273815], [120.31, 239.0, 234.68983620319977], [91.15, 188.0, 177.80715293759172], [223.96, 427.0, 436.8808554240597]]}, "id": "el789204370927760"});
   }(mpld3);
}else if(typeof define === "function" && define.amd){
   // require.js is available: use it to load d3/mpld3
   require.config({paths: {d3: "https://mpld3.github.io/js/d3.v3.min"}});
   require(["d3"], function(d3){
      window.d3 = d3;
      mpld3_load_lib("https://mpld3.github.io/js/mpld3.v0.2.js", function(){
         
         mpld3.draw_figure("fig_el7892043709277604105873069", {"axes": [{"xlim": [0.0, 600.0], "yscale": "linear", "axesbg": "#FFFFFF", "texts": [{"v_baseline": "hanging", "h_anchor": "middle", "color": "#000000", "text": "SWE_pillow", "coordinates": "axes", "zorder": 3, "alpha": 1, "fontsize": 12.0, "position": [0.5, -0.059895833333333329], "rotation": -0.0, "id": "el789204371027408"}, {"v_baseline": "auto", "h_anchor": "middle", "color": "#000000", "text": "SWE_course", "coordinates": "axes", "zorder": 3, "alpha": 1, "fontsize": 12.0, "position": [-0.084047379032258063, 0.5], "rotation": -90.0, "id": "el789204371162448"}], "zoomable": true, "images": [], "xdomain": [0.0, 600.0], "ylim": [0.0, 1200.0], "paths": [], "sharey": [], "sharex": [], "axesbgalpha": null, "axes": [{"scale": "linear", "tickformat": null, "grid": {"gridOn": false}, "fontsize": 12.0, "position": "bottom", "nticks": 7, "tickvalues": null}, {"scale": "linear", "tickformat": null, "grid": {"gridOn": false}, "fontsize": 12.0, "position": "left", "nticks": 7, "tickvalues": null}], "lines": [{"color": "#000000", "yindex": 2, "coordinates": "data", "dasharray": "6,6", "zorder": 2, "alpha": 1, "xindex": 0, "linewidth": 1.0, "data": "data01", "id": "el789204435494160"}], "markers": [{"edgecolor": "#000000", "facecolor": "#FF0000", "edgewidth": 0.5, "yindex": 1, "coordinates": "data", "zorder": 2, "markerpath": [[[0.0, 3.0], [0.7956093000000001, 3.0], [1.5587396123545605, 2.683901074764725], [2.121320343559643, 2.121320343559643], [2.683901074764725, 1.5587396123545605], [3.0, 0.7956093000000001], [3.0, 0.0], [3.0, -0.7956093000000001], [2.683901074764725, -1.5587396123545605], [2.121320343559643, -2.121320343559643], [1.5587396123545605, -2.683901074764725], [0.7956093000000001, -3.0], [0.0, -3.0], [-0.7956093000000001, -3.0], [-1.5587396123545605, -2.683901074764725], [-2.121320343559643, -2.121320343559643], [-2.683901074764725, -1.5587396123545605], [-3.0, -0.7956093000000001], [-3.0, 0.0], [-3.0, 0.7956093000000001], [-2.683901074764725, 1.5587396123545605], [-2.121320343559643, 2.121320343559643], [-1.5587396123545605, 2.683901074764725], [-0.7956093000000001, 3.0], [0.0, 3.0]], ["M", "C", "C", "C", "C", "C", "C", "C", "C", "Z"]], "alpha": 1, "xindex": 0, "data": "data01", "id": "el789204435493456pts"}], "id": "el789204370929424", "ydomain": [0.0, 1200.0], "collections": [], "xscale": "linear", "bbox": [0.125, 0.099999999999999978, 0.77500000000000002, 0.80000000000000004]}], "height": 480.0, "width": 640.0, "plugins": [{"type": "reset"}, {"enabled": false, "button": true, "type": "zoom"}, {"enabled": false, "button": true, "type": "boxzoom"}], "data": {"data01": [[0.52, 0.0, 1.0143688373839572], [0.0, 0.0, 0.0], [471.88, 1031.0, 920.5007057398878], [0.0, 0.0, 0.0], [60.42, 193.0, 117.86185606680517], [102.6, 178.0, 200.14277445306536], [0.0, 0.0, 0.0], [0.52, 0.0, 1.0143688373839572], [192.71, 361.0, 375.92118971588917], [156.77, 279.0, 305.81269737823646], [0.0, 0.0, 0.0], [14.06, 51.0, 27.42697279542007], [0.0, 0.0, 0.0], [0.52, 0.0, 1.0143688373839572], [8.33, 25.0, 16.249408491169927], [441.15, 884.0, 860.5554088691013], [350.0, 615.0, 682.7482559315096], [218.23, 438.0, 425.7032911198095], [416.15, 711.0, 811.7876763025648], [3.13, 0.0, 6.105720117330357], [0.0, 25.0, 0.0], [73.96, 147.0, 144.27446002484126], [0.0, 0.0, 0.0], [13.54, 25.0, 26.41260395803611], [70.31, 127.0, 137.15437107012698], [319.79, 559.0, 623.817327898107], [86.98, 173.0, 169.67269514549344], [0.52, 0.0, 1.0143688373839572], [547.92, 1102.0, 1068.8326411142648], [472.4, 965.0, 921.5150745772718], [182.81, 432.0, 356.60916761954076], [55.21, 117.0, 107.69866059993899], [282.29, 544.0, 550.6657290483024], [58.85, 142.0, 114.79924246162669], [73.96, 140.0, 144.27446002484126], [0.0, 0.0, 0.0], [81.25, 178.0, 158.49513084124328], [53.13, 132.0, 103.64118525040315], [127.6, 254.0, 248.91050701960177], [0.0, 0.0, 0.0], [233.85, 330.0, 456.1733704273815], [120.31, 239.0, 234.68983620319977], [91.15, 188.0, 177.80715293759172], [223.96, 427.0, 436.8808554240597]]}, "id": "el789204370927760"});
      });
    });
}else{
    // require.js not available: dynamically load d3 & mpld3
    mpld3_load_lib("https://mpld3.github.io/js/d3.v3.min.js", function(){
         mpld3_load_lib("https://mpld3.github.io/js/mpld3.v0.2.js", function(){
                 
                 mpld3.draw_figure("fig_el7892043709277604105873069", {"axes": [{"xlim": [0.0, 600.0], "yscale": "linear", "axesbg": "#FFFFFF", "texts": [{"v_baseline": "hanging", "h_anchor": "middle", "color": "#000000", "text": "SWE_pillow", "coordinates": "axes", "zorder": 3, "alpha": 1, "fontsize": 12.0, "position": [0.5, -0.059895833333333329], "rotation": -0.0, "id": "el789204371027408"}, {"v_baseline": "auto", "h_anchor": "middle", "color": "#000000", "text": "SWE_course", "coordinates": "axes", "zorder": 3, "alpha": 1, "fontsize": 12.0, "position": [-0.084047379032258063, 0.5], "rotation": -90.0, "id": "el789204371162448"}], "zoomable": true, "images": [], "xdomain": [0.0, 600.0], "ylim": [0.0, 1200.0], "paths": [], "sharey": [], "sharex": [], "axesbgalpha": null, "axes": [{"scale": "linear", "tickformat": null, "grid": {"gridOn": false}, "fontsize": 12.0, "position": "bottom", "nticks": 7, "tickvalues": null}, {"scale": "linear", "tickformat": null, "grid": {"gridOn": false}, "fontsize": 12.0, "position": "left", "nticks": 7, "tickvalues": null}], "lines": [{"color": "#000000", "yindex": 2, "coordinates": "data", "dasharray": "6,6", "zorder": 2, "alpha": 1, "xindex": 0, "linewidth": 1.0, "data": "data01", "id": "el789204435494160"}], "markers": [{"edgecolor": "#000000", "facecolor": "#FF0000", "edgewidth": 0.5, "yindex": 1, "coordinates": "data", "zorder": 2, "markerpath": [[[0.0, 3.0], [0.7956093000000001, 3.0], [1.5587396123545605, 2.683901074764725], [2.121320343559643, 2.121320343559643], [2.683901074764725, 1.5587396123545605], [3.0, 0.7956093000000001], [3.0, 0.0], [3.0, -0.7956093000000001], [2.683901074764725, -1.5587396123545605], [2.121320343559643, -2.121320343559643], [1.5587396123545605, -2.683901074764725], [0.7956093000000001, -3.0], [0.0, -3.0], [-0.7956093000000001, -3.0], [-1.5587396123545605, -2.683901074764725], [-2.121320343559643, -2.121320343559643], [-2.683901074764725, -1.5587396123545605], [-3.0, -0.7956093000000001], [-3.0, 0.0], [-3.0, 0.7956093000000001], [-2.683901074764725, 1.5587396123545605], [-2.121320343559643, 2.121320343559643], [-1.5587396123545605, 2.683901074764725], [-0.7956093000000001, 3.0], [0.0, 3.0]], ["M", "C", "C", "C", "C", "C", "C", "C", "C", "Z"]], "alpha": 1, "xindex": 0, "data": "data01", "id": "el789204435493456pts"}], "id": "el789204370929424", "ydomain": [0.0, 1200.0], "collections": [], "xscale": "linear", "bbox": [0.125, 0.099999999999999978, 0.77500000000000002, 0.80000000000000004]}], "height": 480.0, "width": 640.0, "plugins": [{"type": "reset"}, {"enabled": false, "button": true, "type": "zoom"}, {"enabled": false, "button": true, "type": "boxzoom"}], "data": {"data01": [[0.52, 0.0, 1.0143688373839572], [0.0, 0.0, 0.0], [471.88, 1031.0, 920.5007057398878], [0.0, 0.0, 0.0], [60.42, 193.0, 117.86185606680517], [102.6, 178.0, 200.14277445306536], [0.0, 0.0, 0.0], [0.52, 0.0, 1.0143688373839572], [192.71, 361.0, 375.92118971588917], [156.77, 279.0, 305.81269737823646], [0.0, 0.0, 0.0], [14.06, 51.0, 27.42697279542007], [0.0, 0.0, 0.0], [0.52, 0.0, 1.0143688373839572], [8.33, 25.0, 16.249408491169927], [441.15, 884.0, 860.5554088691013], [350.0, 615.0, 682.7482559315096], [218.23, 438.0, 425.7032911198095], [416.15, 711.0, 811.7876763025648], [3.13, 0.0, 6.105720117330357], [0.0, 25.0, 0.0], [73.96, 147.0, 144.27446002484126], [0.0, 0.0, 0.0], [13.54, 25.0, 26.41260395803611], [70.31, 127.0, 137.15437107012698], [319.79, 559.0, 623.817327898107], [86.98, 173.0, 169.67269514549344], [0.52, 0.0, 1.0143688373839572], [547.92, 1102.0, 1068.8326411142648], [472.4, 965.0, 921.5150745772718], [182.81, 432.0, 356.60916761954076], [55.21, 117.0, 107.69866059993899], [282.29, 544.0, 550.6657290483024], [58.85, 142.0, 114.79924246162669], [73.96, 140.0, 144.27446002484126], [0.0, 0.0, 0.0], [81.25, 178.0, 158.49513084124328], [53.13, 132.0, 103.64118525040315], [127.6, 254.0, 248.91050701960177], [0.0, 0.0, 0.0], [233.85, 330.0, 456.1733704273815], [120.31, 239.0, 234.68983620319977], [91.15, 188.0, 177.80715293759172], [223.96, 427.0, 436.8808554240597]]}, "id": "el789204370927760"});
            })
         });
}
</script>


Here are the calibration points from the historical data:

        DATE, VARA_SWE_COURSE, VARA_SWE_PILLOW
        2009-10-29 14:00:00, 25.0, 8.33
        2009-11-25 14:00:00, 178.0, 81.25
        2009-12-18 11:00:00, 173.0, 86.98
        2010-01-14 13:00:00, 140.0, 73.96
        2010-02-08 12:00:00, 188.0, 91.15
        2010-03-04 13:00:00, 127.0, 70.31
        2010-03-24 10:00:00, 178.0, 102.6
        2010-04-21 12:00:00, 279.0, 156.77
        2010-05-27 10:00:00, 0.0, 0.0
        2010-11-03 13:00:00, 0.0, 0.52
        2011-01-20 14:00:00, 438.0, 218.23
        2011-02-21 13:00:00, 544.0, 282.29
        2011-03-31 11:00:00, 1031.0, 471.88
        2011-04-27 12:00:00, 1102.0, 547.92
        2011-06-02 10:00:00, 884.0, 441.15
        2011-07-01 15:00:00, 0.0, 0.0
        2011-10-04 13:00:00, 0.0, 0.0
        2011-11-28 14:00:00, 117.0, 55.21
        2011-12-22 13:00:00, 193.0, 60.42
        2012-01-14 14:00:00, 132.0, 53.13
        2012-02-10 12:00:00, 361.0, 192.71
        2012-03-30 10:00:00, 965.0, 472.4
        2012-03-08 13:00:00, 559.0, 319.79
        2012-05-14 11:00:00, 427.0, 223.96
        2012-06-06 14:00:00, 0.0, 0.0
        2012-10-20 15:00:00, 0.0, 0.52
        2012-11-06 15:00:00, 0.0, 0.52
        2012-12-05 14:00:00, 25.0, 13.54
        2013-01-07 14:00:00, 432.0, 182.81
        2013-02-11 11:00:00, 615.0, 350.0
        2013-03-12 10:00:00, 711.0, 416.15
        2013-04-30 12:00:00, 330.0, 233.85
        2013-05-29 13:00:00, 0.0, 0.0
        2013-11-04 15:00:00, 51.0, 14.06
        2013-10-09 11:00:00, 0.0, 0.0
        2013-11-14 10:00:00, 0.0, 0.52
        2013-12-04 12:00:00, 0.0, 3.13
        2013-12-13 12:00:00, 25.0, 0.0
        2014-01-07 14:00:00, 0.0, 0.0
        2014-02-13 12:00:00, 147.0, 73.96
        2014-02-28 12:00:00, 254.0, 127.6
        2014-03-24 13:00:00, 142.0, 58.85
        2014-04-03 12:00:00, 239.0, 120.31
        2014-05-20 14:00:00, 0.0, 0.0


Technical notes
-----------

The forced zero linear-regression from least squares is based on the built in module from numpy, and the code to generate it and its graph are(generically)


        x = x[:, np.newaxis]
        a, _, _, _ = np.linalg.lstsq(x, y)
        print "the coefficient is %s" %(a)


I built my own regression function, which is this. The documentation for some "built in" functions lead me to believe that the Pearson's R was being squared in the internal calculation of r-squared, and this is incorrect. Use this method instead:


        def regress(x,y):
            regression = np.polyfit(x, y,1)
            fitfxn = np.poly1d(regression)

            yhat = fitfxn(x)

            ybar = np.sum(y)/len(y)
            ssreg = np.sum((yhat-ybar)**2)
            sstot = np.sum((y- ybar)**2)
            r2 = ssreg/sstot

            print "the r-squared is: %s" %r2
            print "the coefficients are: %s" %np.poly1d(fitfxn)

            return r2, fitfxn, regression